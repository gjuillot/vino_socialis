

<ul class="nav nav-tabs" id="myTab">
  <li class="active"><a href="#summary" data-toggle="tab"><%= t('user.stat.summary.title') %></a></li>
  <li><a href="#areas" data-toggle="tab"><%= t('user.stat.areas') %></a></li>
  <li><a href="#colors" data-toggle="tab"><%= t('user.stat.colors') %></a></li>
  <li><a href="#vintages" data-toggle="tab"><%= t('user.stat.vintages') %></a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="summary">
    <dl class="dl-horizontal">
      <dt><%= t('user.stat.summary.total_title') %></dt>
      <dd><%= t('user.stat.summary.total_count', count: @bottles) %></dd>
      
      <dt><%= t('user.stat.summary.price_title')%></dt>
      <dd><%= formated_price(@price) %></dd>
      
      <dt><%= t('user.stat.summary.current_value_title')%></dt>
      <dd><%= formated_price(@current_value) %></dd>
      
      <dt><%= t('user.stat.summary.oldest_title')%></dt>
      <dd><%= link_to bottle_name(@oldest), @oldest %></dd>
      
      <dt><%= t('user.stat.summary.most_expensive_title')%></dt>
      <dd><%= link_to bottle_name(@most_expensive), @most_expensive %> - <%= formated_price @most_expensive.current_value %></dd>
      
      <dt><i class="icon-heart"></i></dt>
      <dd><%= t('user.stat.summary.recommandations_count', count: @user.wine_recommandations.count) %> </dd>
      
      <dt><i class="icon-hand-down"></i></dt>
      <dd><%= t('user.stat.summary.consumptions_count', count: @user.consumptions.sum(:quantity)) %> </dd>
    </dl>
  </div>
  <div class="tab-pane" id="areas"></div>
  <div class="tab-pane" id="colors"></div>
  <div class="tab-pane" id="vintages"></div>
</div>

<script type="text/javascript">
areas =
  {
    "name": "areas",
    "children": [
      <% @countries.each do |country, regions| %>
      {
        "name": "<%= country.name %>",
        "children": [
          <% regions.each do |region, areas| %>
          {
            "name": "<%= region.name %>",
            "children": [
              <% areas.each do |area, colors| %>
              {
                "name": "<%= area.name %>",
                "children": [
                  <% colors.each do |color, vintages| %>
                  {
                    "name": "<%= t(color, scope: 'wine.color') %>",
                    "children": [
                      <% vintages.each do |vintage, count| %>
                        {"name": "<%= formated_vintage vintage, false %>", "size": <%= count %>},
                      <% end %>
                    ]
                  },
                  <% end %>
                ]
              },
              <% end %>
            ]
          },
          <% end %>
        ]
      },
      <% end %>
    ]
  };
  
colors =
  {
    "name": "colors",
    "children": [
      <% @colors.each do |color, count| %>
        {"name": "<%= t(color, scope: 'wine.color') %>", "size": <%= count %>},
      <% end %>
    ]
  };
  
vintages =
  {
    "name": "vintages",
    "children": [
      <% @vintages.each do |vintage, count| %>
        {"name": "<%= formated_vintage vintage, false %>", "size": <%= count %>},
      <% end %>
    ]
  };

  
bargraph(areas, 'div#areas');
bargraph(colors, 'div#colors');
bargraph(vintages, 'div#vintages');

</script>